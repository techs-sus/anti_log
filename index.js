import o from"chalk";import e from"clipboardy";import t from"conf";import n from"express";import r from"fs/promises";import a from"ngrok";import i from"os";import c from"vorpal";import s from"process";import l from"dotenv";l.config(),null==s.env.NGROK_AUTH&&(console.log("No ngrok auth key!"),s.exit(1));const p=new c,m=new t({projectName:"anti_log"}),d=i.userInfo().homedir,u=s.cwd()+"/";let y,f,v;async function g(o){(m.get("auto_copy")||o)&&await e.write(`c/NS(game:GetService("HttpService"):GetAsync("${v||"http://localhost:3002"}",false),script);script:Destroy()`)}p.command("clear","Clears terminal.").action((async()=>{console.clear()})),p.command("autocopy <boolean>","Decides if autocopying the url will happen when a new tunnel is made.").action((async o=>{const e=Boolean(o.boolean);m.set("auto_copy",e),p.log(e?"Auto copy set to true.":"Auto copy set to false.")})),p.command("copy","Copy the tun.url to your clipboard. (clipboardy)").action((async()=>{void 0!==v?(g(!0),p.log(v)):p.log("You must serve a file first.")})),p.command("stop","Stop serving the file.").action((async()=>{void 0!==v&&(a.disconnect(v),p.log("Closed tunnel."),v=void 0),void 0!==f&&(f.close(),p.log("Closed express server."),f=void 0)})),p.command("serve <file>","Serves <file> with protection.").action((async o=>{if(void 0!==f)return void p.log("Please run stop.");const e=o.file.replace("~",d).replace("./",u);y=n();let t=!0;y.get("/",(async(o,n)=>{if(t){const o=(await r.readFile(e)).toString().split("").map((o=>"\\x"+o.charCodeAt(0).toString(16))).join("");t=!1,n.status(200).send('game:GetService("HttpService"):GetAsync('+(v||"https://localhost:3002")+`);script:Destroy();local _ = NS("${o}", owner.PlayerGui);_.Name='SB_Tusk_Maidenless'`)}else n.status(404).send("no!!!"),setTimeout((async()=>{void 0!==v&&a.disconnect(v),t=!0,v=await a.connect({authtoken:s.env.NGROK_AUTH,port:3002}),g(!1)}),200)})),f=y.listen(3002,(async()=>{v=await a.connect({authtoken:s.env.NGROK_AUTH,port:3002}),p.log("Tunnel ready!"),g(!1)}))})),p.delimiter(o.magenta(s.cwd().replace(d,"~")+" >")).show();
